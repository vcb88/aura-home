# Документация проекта AURA: Разумный Дом Нового Поколения

## 1. Введение

**AURA (Adaptive Unified Residential Agent)** — это инновационный проект, нацеленный на трансформацию концепции умного дома. Мы переходим от жестких, заранее заданных автоматизаций к проактивной, адаптивной и по-настоящему интеллектуальной системе, способной понимать контекст, рассуждать и предвосхищать потребности пользователя.

*   **Видение:** Создать интуитивный, проактивный и адаптивный умный дом, который предвосхищает потребности пользователя и становится незаметным, но незаменимым помощником.
*   **Миссия:** Упростить взаимодействие с технологиями умного дома, сделав их доступными и полезными для каждого, независимо от технических навыков, путем внедрения передовых AI-технологий.

## 2. Проблема, которую мы решаем

Современные системы умного дома, несмотря на название, часто являются лишь набором разрозненных устройств и жестких правил "ЕСЛИ-ТО". Это приводит к:
*   **Сложности настройки:** Пользователям приходится тратить много времени на создание сценариев и отладку.
*   **Отсутствию контекста:** Система не понимает, почему пользователь находится в комнате, и не может адаптироваться к меняющимся условиям.
*   **Неспособности к адаптации:** Жесткие правила не позволяют системе учиться и подстраиваться под меняющиеся привычки жильцов.
*   **Необходимости постоянного ручного управления:** Пользователь вынужден постоянно отдавать команды, вместо того чтобы дом сам о нем заботился.

AURA превращает "автоматизированный" дом в "разумный".

## 3. Целевая аудитория

*   **Основная (платежеспособная):** Владельцы умных домов на базе Home Assistant, ищущие максимальный комфорт и готовые платить за интеллектуальные функции, не желая при этом разбираться в сложных настройках AI.
*   **Вторичная (энтузиасты):** Продвинутые пользователи Home Assistant, ценящие приватность и локальный контроль и готовые к самостоятельной настройке локальных LLM, но нуждающиеся в готовом фреймворке для интеграции AI.

## 4. Ключевые отличия и конкурентные преимущества

*   **Истинная проактивность:** Система предвосхищает потребности пользователя, а не просто реагирует на события.
*   **Глубокая адаптивность:** AURA учится на привычках и предпочтениях каждого члена семьи, адаптируясь к меняющимся условиям и расписанию.
*   **Естественное взаимодействие:** Понимание естественного языка и контекста, а не жестких команд. Возможность мультимодального ввода (голос + жест/камера).
*   **Гибридная модель развертывания:** Уникальное предложение выбора между удобством облачного сервиса (AURA Cloud) и максимальной приватностью/производительностью локального решения (AURA Edge).
*   **Открытая основа:** Использование Home Assistant как фундамента обеспечивает широчайшую совместимость с тысячами устройств и открытость для сообщества.
*   **Многоуровневая память:** Позволяет системе иметь как краткосрочный контекст, так и долгосрочные знания о доме и его обитателях.

## 5. Архитектура системы AURA

AURA построена на микросервисной архитектуре, где каждый компонент отвечает за свою специализированную задачу.

### Общая схема

```
[ Локальный AURA Agent ] <--> [ API Gateway ] <--> [ Оркестратор AURA ] <--> [ Память / Инструменты ]
                                                                ^
                                                                | (MCP)
                                                                v
                                                              [ Инструменты ]
```

### Компоненты системы

1.  **Локальный AURA Agent:**
    *   **Роль:** Легковесный клиент, устанавливаемый в доме пользователя (Home Assistant Add-on или Docker-контейнер). Собирает данные из Home Assistant, отправляет запросы в "мозг" AURA и исполняет полученные команды.
    *   **Особенности:** Имеет переключатель между облачным и локальным режимом работы LLM.

2.  **API Gateway:**
    *   **Роль:** Единая точка входа для всех запросов от локальных агентов. Обеспечивает безопасность, аутентификацию и маршрутизацию запросов к Оркестратору.

3.  **Оркестратор AURA (AI-агент / Планировщик):**
    *   **Роль:** Сердце системы. Принимает запросы, определяет намерение пользователя, собирает контекст, формирует план действий, вызывает необходимые инструменты и LLM/VLM.
    *   **Технологии:** Python (FastAPI), LangChain/LlamaIndex (для логики агентов).

4.  **Протокол MCP (Model Context Protocol):**
    *   **Роль:** Стандартизированный "язык", который позволяет Оркестратору AURA обнаруживать и использовать внешние инструменты.
    *   **Как работает:** Каждый инструмент предоставляет `manifest.json` (описание функций и параметров в JSON Schema) и API-endpoint. Оркестратор использует LLM, чтобы решить, какой инструмент вызвать и с какими параметрами.

5.  **Многоуровневая память:**

    *   **Краткосрочная память (Redis):**
        *   **Назначение:** Хранение текущего состояния всех устройств умного дома и контекста текущего диалога. Сверхбыстрый доступ.
        *   **Технологии:** Redis.
    *   **Долгосрочная (эпизодическая) память:**
        *   **Назначение:** Хранение истории событий, изменений параметров, действий пользователя за длительный период. Для анализа паттернов и обнаружения аномалий.
        *   **Технологии:** PostgreSQL с расширением TimescaleDB.
    *   **Семантическая память (Векторная БД):**
        *   **Назначение:** Хранение знаний, пользовательских предпочтений и связей в виде векторов. Для поиска по смыслу.
        *   **Технологии:** ChromaDB или PostgreSQL с расширением PGVector.

6.  **Инструменты (Toolbox):**

    *   **LLM Service:**
        *   **Роль:** Предоставляет доступ к языковым моделям (облачным или локальным). Оркестратор отправляет сюда промпты для рассуждений, планирования, генерации ответов.
        *   **Технологии:** Облачные API (OpenAI, Anthropic, Google) или локальные серверы (Ollama, llama-cpp-python).
    *   **VLM Service:**
        *   **Роль:** Предоставляет доступ к визуально-языковым моделям. Для анализа изображений с камер, распознавания объектов, действий, контекста.
        *   **Технологии:** Облачные API или локальные модели (например, на базе CLIP, LLaVA).
    *   **RAG Service:**
        *   **Роль:** Извлекает релевантную информацию из базы знаний (инструкции, документация) для обогащения промптов LLM.
        *   **Технологии:** Python, векторная БД (ChromaDB/PGVector), библиотеки для обработки текста.
    *   **Web Search Service:**
        *   **Роль:** Предоставляет доступ к поиску в интернете для получения актуальной информации (погода, новости).
        *   **Технологии:** Python, API поисковых систем.
    *   **Home Assistant Connector:**
        *   **Роль:** Основной исполнительный инструмент. Общается с Home Assistant пользователя через REST и WebSocket API для получения состояний и отправки команд.

## 6. Технологический стек

| Компонент | Технология | Описание |
| :--- | :--- | :--- |
| **Язык программирования** | Python | Основной язык для всех сервисов. |
| **Веб-фреймворк** | FastAPI | Для создания высокопроизводительных API микросервисов. |
| **Краткосрочная память** | Redis | In-memory база данных для текущих состояний и контекста. |
| **Долгосрочная память** | PostgreSQL + TimescaleDB | Реляционная БД с расширением для временных рядов. |
| **Семантическая память / RAG** | ChromaDB / PGVector | Векторная база данных для хранения знаний и эмбеддингов. |
| **AI-фреймворки** | LangChain / LlamaIndex | Для реализации логики агентов и работы с LLM/инструментами. |
| **Локальный LLM-сервер** | Ollama / llama-cpp-python | Для запуска LLM на Edge-устройствах пользователя. |
| **Контейнеризация** | Docker, Docker Compose | Для упаковки и управления всеми микросервисами. |
| **CI/CD** | GitHub Actions | Для автоматизации тестирования и развертывания. |

## 7. Модель развертывания: Гибридная стратегия

AURA предлагает пользователю выбор между облачным удобством и локальной приватностью.

*   **AURA Cloud (SaaS):**
    *   **Развертывание:** Все сервисы AURA (Оркестратор, Память, RAG, LLM/VLM) развернуты на наших серверах.
    *   **Плюсы:** Простота для пользователя, низкие требования к железу, всегда актуальные и мощные модели.
    *   **Минусы:** Зависимость от интернета, вопросы приватности данных.
*   **AURA Edge (Локально):**
    *   **Развертывание:** Оркестратор AURA, Память, RAG и локальный LLM-сервер развернуты на мощном домашнем сервере пользователя (например, NUC).
    *   **Плюсы:** Максимальная приватность, работа без интернета, низкие задержки.
    *   **Минусы:** Высокие требования к железу пользователя, сложнее в настройке.

## 8. Монетизация

*   **AURA Cloud:** SaaS-подписка (ежемесячная/годовая) за доступ к облачным сервисам AURA. Разные тарифные планы.
*   **AURA Edge:**
    *   **Freemium:** Базовый AURA Agent бесплатен, но продвинутые функции (расширенная память, мультиагентное взаимодействие) доступны по подписке или через покупку лицензии.
    *   **Партнерство:** С производителями Edge-оборудования.

## 9. CI/CD Pipeline

Автоматизация тестирования и развертывания с использованием GitHub Actions. Включает линтинг, юнит-тесты, интеграционные тесты (с поднятием всего стека через `docker-compose`), сборку и публикацию Docker-образов.

## 10. Взаимодействие с голосовыми ассистентами (Алиса)

*   **Роль Алисы:** Основной голосовой интерфейс ("уши" и "рот") для AURA.
*   **Техническая организация:**
    *   **Ввод:** AURA перехватывает текстовые запросы пользователя через интеграцию Home Assistant с Алисой (например, через `input_text` хелпер).
    *   **Вывод:** AURA формирует текстовый ответ и передает его Home Assistant, который использует сервис `tts.speak` для озвучивания через Алису.

## 11. Риски, вызовы и этические аспекты

*   **Приватность данных:** Разработка строгой политики и обеспечение локального контроля.
*   **Производительность:** Оптимизация LLM для Edge-устройств и минимизация задержек.
*   **"Халлюцинации" LLM:** Разработка механизмов для минимизации ошибок и обеспечения надежности.
*   **Безопасность:** Защита от несанкционированного доступа.
*   **Контроль пользователя:** Сохранение за пользователем полного контроля над системой и возможность отмены действий AI.
